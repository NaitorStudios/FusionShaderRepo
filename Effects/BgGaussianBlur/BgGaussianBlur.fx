sampler2D img;
sampler2D bkd : register(s1);
float fX,fY,fA,fPixelWidth,fPixelHeight;
/*
const float2 offsets[12] = {
   0.00000067, 0.00002292, 0.00019117, 0.00038771, 0.00019117, 0.00002292, 0.00000067,
   0.00002292, 0.00078633, 0.00655965, 0.01330373, 0.00655965, 0.00078633, 0.00002292,
   0.00019117, 0.00655965, 0.05472157, 0.11098164, 0.05472157, 0.00655965, 0.00019117,
   0.00038771, 0.01330373, 0.11098164, 0.22508352, 0.11098164, 0.01330373, 0.00038771,
   0.00019117, 0.00655965, 0.05472157, 0.11098164, 0.05472157, 0.00655965, 0.00019117,
   0.00002292, 0.00078633, 0.00655965, 0.01330373, 0.00655965, 0.00078633, 0.00002292,
   0.00000067, 0.00002292, 0.00019117, 0.00038771, 0.00019117, 0.00002292, 0.00000067,

};
*/

const float2 offsets[49] = {
-0.00000067, -0.00038771,
-0.00002292, -0.01330373,
-0.00019117, 0.11098164,
0.00038771, 0.22508352,
0.00019117, 0.11098164,
0.00002292, 0.01330373,
0.00000067, 0.00038771,
-0.00002292, -0.00038771,
-0.00078633, -0.01330373,
-0.00655965, 0.11098164,
0.01330373, 0.22508352,
0.00655965, 0.11098164,
0.00078633, 0.01330373,
0.00002292, 0.00038771,
-0.00019117, -0.00038771,
-0.00655965, -0.01330373,
-0.05472157, 0.11098164,
0.11098164, 0.22508352,
0.05472157, 0.11098164,
0.00655965, 0.01330373,
0.00019117, 0.00038771,
-0.00038771, -0.00038771,
-0.01330373, -0.01330373,
-0.11098164, 0.11098164,
0.22508352, 0.22508352,
0.11098164, 0.11098164,
0.01330373, 0.01330373,
0.00038771, 0.00038771,
-0.00019117, -0.00038771,
-0.00655965, -0.01330373,
-0.05472157, 0.11098164,
0.11098164, 0.22508352,
0.05472157, 0.11098164,
0.00655965, 0.01330373,
0.00019117, 0.00038771,
-0.00002292, -0.00038771,
-0.00078633, -0.01330373,
-0.00655965, 0.11098164,
0.01330373, 0.22508352,
0.00655965, 0.11098164,
0.00078633, 0.01330373,
0.00002292, 0.00038771,
-0.00000067, -0.00038771,
-0.00002292, -0.01330373,
-0.00019117, 0.11098164,
0.00038771, 0.22508352,
0.00019117, 0.11098164,
0.00002292, 0.01330373,
0.00000067, 0.00038771,
};

float4 ps_main(float2 In : TEXCOORD0) : COLOR0 { 
    float4 back = tex2D(bkd,In), fore = tex2D(img,In);	
    for(int i=0;i<49;i++)
        back += tex2D(bkd,max(0.0,min(1.0,In+float2(fX,fY)*float2(fPixelWidth,fPixelHeight)*offsets[i])));
    back /= 13;
    back += (tex2D(bkd,In)-back)*(1.0-fore.a);
    back.rgb += (fore.rgb-back.rgb)*fore.a*fA;
    back.a += fore.a;
    return back;
}

technique BgBlur { pass P0 { PixelShader = compile ps_2_0 ps_main(); } }